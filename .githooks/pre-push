#!/bin/sh
# Git pre-push hook
# Runs code quality checks before allowing push

set -e

echo "ğŸ” Running pre-push checks..."
echo ""

# 1. Format check
echo "ğŸ“ Checking code formatting..."
if ! cargo fmt --check; then
    echo "âŒ Code is not formatted. Run 'make fmt' to fix."
    exit 1
fi
if ! taplo format --check; then
    echo "âŒ TOML files are not formatted. Run 'taplo format' to fix."
    exit 1
fi
echo "âœ… Formatting check passed"
echo ""

# 2. Linting
echo "ğŸ” Running linter..."
if ! cargo clippy --all-targets --all-features -- -D warnings; then
    echo "âŒ Clippy found issues. Fix them before pushing."
    exit 1
fi
echo "âœ… Linting passed"
echo ""

# 3. Spell check
echo "ğŸ“– Checking spelling..."
if ! typos; then
    echo "âŒ Typos found. Run 'make spell-fix' to fix automatically."
    exit 1
fi
echo "âœ… Spell check passed"
echo ""

# 4. Type check
echo "ğŸ”§ Type checking..."
if ! cargo check --all-targets; then
    echo "âŒ Type check failed. Fix errors before pushing."
    exit 1
fi
echo "âœ… Type check passed"
echo ""

# 5. Tests
echo "ğŸ§ª Running tests..."
if ! cargo test --all-targets; then
    echo "âŒ Tests failed. Fix failing tests before pushing."
    exit 1
fi
echo "âœ… Tests passed"
echo ""

echo "ğŸ‰ All pre-push checks passed! Proceeding with push..."
exit 0

